# 成本管理模块功能需求

## 一、功能概述

成本管理模块用于统一管理系统的各项成本，包括完全人力成本、差旅成本、外包成本等。该模块由财务人员负责录入和管理，支持部门成本统计和利润计算，同时与驻场制项目的业绩登记关联，实现成本自动化计算。

## 二、功能列表

### 2.1 完全人力成本管理

**功能描述**：
- 财务人员按月录入每个员工的完全人力成本
- 基于成本标准自动计算，录入维度只需要一个数值（在职天数）
- 用于计算部门成本和驻场制项目成本

**功能要求**：

1. **成本记录管理**：
   - 查看成本记录列表（按月份、员工筛选）
   - 创建新的成本记录
   - 编辑现有成本记录
   - 删除成本记录
   - 批量导入成本记录（Excel格式）

2. **成本记录配置**：
   - 员工（必填，下拉选择，从员工列表选择）
   - 月份（必填，日期选择器，格式：YYYY-MM）
   - 在职天数（必填，数字输入，只能是 0、0.5、1）
   - 员工级别（自动带出，只读，创建时快照，后续不可修改）
   - 城市类型（自动带出，只读，创建时快照，后续不可修改）
   - 员工部门（自动带出，只读，创建时快照，后续不可修改）
   - 人日成本（自动计算，只读，从成本标准获取）
   - 总成本（自动计算，只读，计算公式：`dailyCost × workDays × 21.75`）

3. **业务规则**：
   - 每个员工每个月只能有一条成本记录
   - 在职天数只能是 0、0.5、1 三个值
   - **历史数据快照机制**：
     - 创建成本记录时，系统自动快照员工的关键信息（姓名、级别、城市类型、部门）
     - 快照信息存储在成本记录中，后续员工信息变化不影响历史成本记录
     - 查询历史成本时，使用快照信息，而不是实时查询员工表
     - 即使员工离职、级别变化、部门调整，历史成本记录保持不变
   - 人日成本必须从成本标准获取，如果找不到对应的成本标准，不允许录入
   - 总成本自动计算，不允许手动修改
   - 只有财务人员可以录入和修改
   - **历史数据保护**：成本记录创建后，快照字段（姓名、级别、城市类型、部门）不允许修改

4. **批量导入**：
   - 支持Excel格式导入
   - Excel格式：员工姓名、月份、在职天数
   - 系统自动匹配员工、获取成本标准、计算总成本
   - 导入时验证数据格式和完整性
   - 导入结果提示（成功、失败、错误原因）

**交互设计**：
- 成本记录列表使用表格展示
- 支持按月份、员工、部门筛选
- **历史数据展示**：
  - 列表显示员工信息时，使用快照信息（即使员工已离职、级别已变化、部门已调整）
  - 已离职员工的历史成本记录正常显示，标记为"已离职"状态（可选）
  - 员工信息变化不影响历史成本记录的显示和查询
- 支持导出成本记录（Excel格式）
- 创建/编辑成本记录使用弹窗表单
  - 创建时：自动快照员工信息，快照字段只读显示
  - 编辑时：快照字段不可修改，只允许修改在职天数
- 批量导入使用文件上传组件

### 2.2 差旅成本管理

**功能描述**：
- 财务人员按月录入项目和商机的差旅成本
- 与项目详情页的差旅支出功能并存，数据共享

**功能要求**：

1. **项目差旅成本管理**：
   - 查看项目差旅成本列表（按月份、项目筛选）
   - 创建新的差旅成本记录
   - 编辑现有差旅成本记录
   - 删除差旅成本记录

2. **商机差旅成本管理**：
   - 查看商机差旅成本列表（按月份、商机筛选）
   - 创建新的差旅成本记录
   - 编辑现有差旅成本记录
   - 删除差旅成本记录

3. **差旅成本配置**：
   - 项目/商机（必填，下拉选择）
   - 月份（必填，日期选择器，格式：YYYY-MM）
   - 出差事项（必填，文本输入）
   - 大交通费用（可选，数字输入，单位：元）
   - 住宿费用（可选，数字输入，单位：元）
   - 小交通费用（可选，数字输入，单位：元）
   - 差旅补贴（可选，数字输入，单位：元）
   - 其他费用（可选，数字输入，单位：元）
   - 总成本（自动计算，只读，所有费用项之和）

4. **业务规则**：
   - 一个项目/商机一个月可以有多条差旅成本记录
   - 总成本自动计算：所有费用项之和
   - 至少有一项费用 > 0
   - 只有财务人员可以录入和修改
   - 与项目详情页的差旅支出功能并存，数据共享

**交互设计**：
- 使用标签页切换"项目差旅"和"商机差旅"
- 成本记录列表使用表格展示
- 支持按月份、项目/商机筛选
- 支持导出成本记录（Excel格式）
- 创建/编辑成本记录使用弹窗表单

### 2.3 外包成本管理

**功能描述**：
- 财务人员按月录入项目和商机的外包成本
- 与项目详情页的外包支出功能并存，数据共享

**功能要求**：

1. **项目外包成本管理**：
   - 查看项目外包成本列表（按月份、项目筛选）
   - 创建新的外包成本记录
   - 编辑现有外包成本记录
   - 删除外包成本记录

2. **商机外包成本管理**：
   - 查看商机外包成本列表（按月份、商机筛选）
   - 创建新的外包成本记录
   - 编辑现有外包成本记录
   - 删除外包成本记录

3. **外包成本配置**：
   - 项目/商机（必填，下拉选择）
   - 月份（必填，日期选择器，格式：YYYY-MM）
   - 外包事项（必填，文本输入）
   - 供应商（可选，下拉选择，从供应商列表选择）
   - 外包金额（必填，数字输入，单位：元，必须 > 0）

4. **业务规则**：
   - 一个项目/商机一个月可以有多条外包成本记录
   - 只有财务人员可以录入和修改
   - 与项目详情页的外包支出功能并存，数据共享

**交互设计**：
- 使用标签页切换"项目外包"和"商机外包"
- 成本记录列表使用表格展示
- 支持按月份、项目/商机筛选
- 支持导出成本记录（Excel格式）
- 创建/编辑成本记录使用弹窗表单

### 2.4 部门成本统计

**功能描述**：
- 按部门和月份统计部门总成本
- 部门成本包括：人力成本、项目差旅成本、项目外包成本、商机差旅成本、商机外包成本
- 支持查看成本明细和导出

**功能要求**：

1. **部门成本统计**：
   - 查看部门成本列表（按月份、部门筛选）
   - 查看部门成本明细（人力、差旅、外包）
   - 导出部门成本明细（Excel格式）

2. **成本构成**：
   - 部门人力成本（按员工列表）
   - 部门项目差旅成本（按项目列表）
   - 部门项目外包成本（按项目列表）
   - 部门商机差旅成本（按商机列表）
   - 部门商机外包成本（按商机列表）
   - 部门总成本（自动计算）

3. **计算公式**：
   ```
   部门成本 = 部门人力成本 + 部门项目差旅成本 + 部门项目外包成本 + 部门商机差旅成本 + 部门商机外包成本
   ```

4. **业务规则**：
   - 部门成本基于该部门的所有成本记录计算
   - **历史数据保护**：
     - 部门人力成本统计基于历史快照的部门信息，而不是实时查询员工表的当前部门
     - 即使员工后续部门调整，历史成本仍归属于当时的部门
     - 确保历史部门成本统计的准确性
   - 如果成本记录缺失，部门成本统计可能不准确
   - 支持按月份查看历史成本数据

**交互设计**：
- 部门成本列表使用表格展示
- 支持按月份、部门筛选
- 点击部门名称查看成本明细
- 成本明细使用折叠面板展示各项成本
- 支持导出成本明细（Excel格式）
- 支持图表展示（柱状图、折线图）

### 2.5 部门利润统计

**功能描述**：
- 按部门和月份统计部门利润
- 部门利润 = 部门业绩 - 部门成本
- 支持查看利润构成和趋势分析

**功能要求**：

1. **部门利润统计**：
   - 查看部门利润列表（按月份、部门筛选）
   - 查看利润构成（业绩、成本、利润）
   - 查看利润趋势（图表展示）

2. **利润构成**：
   - 部门业绩（从业绩管理模块获取）
   - 部门成本（按上述规则计算）
   - 部门利润（自动计算：业绩 - 成本）

3. **计算公式**：
   ```
   部门利润 = 部门业绩 - 部门成本
   ```

4. **业务规则**：
   - 部门业绩从业绩管理模块获取
   - 部门成本按上述规则计算
   - 支持按月份查看历史利润数据

**交互设计**：
- 部门利润列表使用表格展示
- 支持按月份、部门筛选
- 点击部门名称查看利润明细
- 利润明细使用折叠面板展示业绩和成本
- 支持图表展示（柱状图、折线图、饼图）
- 支持同比、环比分析

### 2.6 驻场制项目成本查看

**功能描述**：
- 查看驻场制项目的成本记录
- 成本记录由系统自动创建（与业绩登记关联）
- 支持查看成本明细和核对

**功能要求**：

1. **成本记录查看**：
   - 查看驻场制项目的成本记录列表（按月份）
   - 查看每个月的参与人员和成本
   - 查看项目总成本

2. **成本明细**：
   - 月份
   - 参与人员列表（员工姓名、员工级别、城市类型、人日成本、总成本）
   - 当月总成本

3. **业务规则**：
   - 成本记录由系统自动创建，财务人员不能手动创建或删除
   - 如果修改员工的月度完全人力成本，系统自动重新计算关联的项目成本
   - 如果重新登记业绩（修改人员选择），系统自动更新项目成本记录

**交互设计**：
- 成本记录列表使用表格展示
- 支持按月份筛选
- 点击月份查看成本明细
- 成本明细使用表格展示参与人员和成本
- 支持导出成本明细（Excel格式）

## 三、交互设计

### 3.1 页面布局

**成本管理主页面**：
- 顶部导航：人力成本、差旅成本、外包成本、部门成本统计、部门利润统计
- 左侧筛选栏：月份、部门、项目/商机、员工
- 主内容区：成本记录列表或统计图表

### 3.2 列表展示

**成本记录列表**：
- 使用表格展示
- 支持排序（按月份、金额等）
- 支持分页
- 支持批量操作（导出、删除）

**统计列表**：
- 使用表格展示
- 支持排序（按月份、金额等）
- 支持分页
- 支持图表切换（表格/图表）

### 3.3 表单设计

**创建/编辑成本记录**：
- 使用弹窗表单
- 必填字段使用红色星号标记
- 自动计算字段使用只读输入框
- 支持表单验证和错误提示

**批量导入**：
- 使用文件上传组件
- 支持拖拽上传
- 显示导入进度
- 导入结果提示（成功、失败、错误原因）

### 3.4 图表展示

**成本统计图表**：
- 柱状图：按月份展示成本趋势
- 折线图：展示成本变化趋势
- 饼图：展示成本构成比例

**利润统计图表**：
- 柱状图：按月份展示利润趋势
- 折线图：展示利润变化趋势
- 组合图：同时展示业绩和成本

## 四、权限控制

### 4.1 功能权限

**财务人员**：
- 可以访问所有成本管理功能
- 可以录入和修改所有类型的成本
- 可以查看所有成本记录和统计
- 可以导出成本数据

**部门主管**：
- 可以查看本部门的成本统计和利润统计
- 可以查看本部门的成本明细
- 不能录入和修改成本

**项目经理**：
- 可以查看关联项目的成本明细
- 不能录入和修改成本（驻场制项目除外，可以通过业绩登记间接影响成本）

**普通员工**：
- 不能访问成本管理模块

### 4.2 数据权限

**成本记录查看**：
- 财务人员可以查看所有成本记录
- 部门主管可以查看本部门的成本记录
- 项目经理可以查看关联项目的成本记录

**成本统计查看**：
- 财务人员可以查看所有部门的成本统计
- 部门主管可以查看本部门的成本统计
- 其他人员不能查看成本统计

## 五、非功能需求

### 5.1 性能要求

- 成本记录列表加载时间 < 2秒
- 部门成本统计计算时间 < 3秒
- 支持大数据量导出（> 10000条记录）

### 5.2 数据安全

- 成本数据加密存储
- 操作日志记录（谁、什么时候、做了什么）
- 数据备份和恢复

### 5.3 用户体验

- 界面简洁清晰
- 操作流程顺畅
- 错误提示友好
- 支持快捷键操作

## 六、总结

成本管理模块的核心功能是：
1. **完全人力成本管理**：财务人员按月录入每个员工的完全人力成本
2. **差旅成本管理**：财务人员按月录入项目和商机的差旅成本
3. **外包成本管理**：财务人员按月录入项目和商机的外包成本
4. **部门成本统计**：按部门和月份统计部门总成本
5. **部门利润统计**：按部门和月份统计部门利润
6. **驻场制项目成本查看**：查看驻场制项目的成本记录

主要特点：
1. 统一的成本管理入口，集中管理所有成本数据
2. 财务人员负责录入，确保数据准确性
3. 基于成本标准自动计算，减少人工错误
4. 支持部门成本统计，便于成本分析和利润计算
5. 驻场制项目成本与业绩登记关联，自动化程度高

