# 专业贡献模块业务逻辑规则

## 一、数据模型

### 1.1 核心实体

#### Contribution（专业贡献）

**专业贡献类别（`category`）**：
- `专项调研`：行业调研、行业简报
- `案例文章`：项目案例、专业文章
- `演讲分享`：小型分享、企业培训演讲、行业活动演讲、项目工作坊、主题工作坊
- `专项研讨`：工作坊执行、圆桌主题会议
- `创方法`：创方法-项目并行、创方法-全新研发
- `其他`：其他类型的专业贡献

**专业贡献子类别（`subCategory`）**：
根据专业贡献实施制度，每个类别下有具体的子类别，如：
- 专项调研：行业调研（3积分）、行业简报（1积分）
- 案例文章：项目案例（1积分）、专业文章（1积分）
- 演讲分享：小型分享（1积分）、企业培训演讲（2积分）、行业活动演讲（3积分）、项目工作坊（3积分）、主题工作坊（3积分）
- 专项研讨：工作坊执行（1积分）、圆桌主题会议（3积分）
- 创方法：创方法-项目并行（1积分）、创方法-全新研发（1积分）
- 其他：由申请人灵活填写

**积分（`points`）**：
- 类型：数字（必填）
- 说明：积分由申请人在立项申请时填写，灵活设置
- 业务规则：积分用于专业贡献的考核和奖励，具体规则参考专业贡献实施制度

**专业贡献状态（`status`）**：
- `pending`：待审批（立项申请已提交，等待主管审批）
- `in_progress`：进行中（审批通过后，已创建任务，正在执行）
- `acceptance_pending`：待验收（已提交验收申请，等待验收确认）
- `accepted`：已验收通过（验收确认通过）
- `rejected`：已拒绝（立项审批被拒绝或验收被拒绝）
- `archived`：已归档

**核心字段**：
- `id`：专业贡献ID（唯一标识）
- `code`：专业贡献编号（自动生成，格式：CONT-YYYY-XXX，不在UI中显示）
- `name`：专业贡献名称（必填）
- `category`：专业贡献类别（必填）
- `subCategory`：专业贡献子类别（必填，如果类别是"其他"，则灵活填写）
- `description`：立项说明（可选，包含目标、计划、内容框架、交付物等）
- `executors`：执行人列表（必填，至少一个执行人，每个执行人有独立的积分）
- `status`：专业贡献状态
- `applicantId`：申请人ID（必填）
- `applicantName`：申请人姓名
- `group`：归属部门（Department枚举，必填）
- `createDate`：立项日期（必填，格式：YYYY-MM-DD）
- `approvalStatus`：审批状态（'pending' | 'approved' | 'rejected'）
- `approverId`：审批人ID（主管）
- `approverName`：审批人姓名
- `approvedAt`：审批时间
- `approvalComment`：审批意见（可选）
- `acceptanceStatus`：验收状态（'pending' | 'accepted' | 'rejected'）
- `accepterId`：验收人ID（专人）
- `accepterName`：验收人姓名
- `acceptedAt`：验收时间
- `acceptanceComment`：验收意见（可选）
- `rating`：评级（'A' | 'B' | 'C'，可选，总监评级）
- `ratedAt`：评级时间
- `ratedBy`：评级人ID（总监）
- `ratedByName`：评级人姓名
- `createdAt`：创建时间
- `updatedAt`：更新时间

**业务规则**：
- 专业贡献可以由员工自行立项，也可以由主管帮下属立项
- 员工自行立项：需要主管审批，审批通过后状态直接变为"进行中"
- 主管帮下属立项：自动完成立项审批，状态直接变为"进行中"
- 审批通过后，系统自动为每个执行人创建一条任务：
  - 任务名称与专业贡献名称相同
  - 任务执行者就是对应的执行人（`assigneeId = executorId`）
  - 任务关联到该专业贡献（`entityType = 'contribution'`, `entityId = contributionId`）
- 一个专业贡献关联的任务就是自动为执行人创建的任务，不需要主管后续创建其他任务
- 只有状态为"进行中"的专业贡献才能分配计划工时
- 专业贡献的计划工时分配权限属于归属部门主管
- 员工可以录入实际工时（通过任务管理模块）
- 申请人或执行人列表中的任意执行人都可以发起验收申请
- 验收由专人确认（具体角色可在审批模块配置）
- 验收通过后，总监可以对专业贡献进行评级（A/B/C）
- 评级可以随时修改

**关联关系**：
- 一个专业贡献关联的任务就是系统自动为每个执行人创建的任务（通过任务管理模块，`entityType = 'contribution'`）
- 审批通过后，系统自动为每个执行人创建一条任务，任务名称与专业贡献名称相同，任务执行者就是对应的执行人
- 任务和工时管理已在任务和工时管理模块中详细说明，这里只形成关联

#### ContributionExecutor（专业贡献执行人）

**核心字段**：
- `id`：执行人记录ID（唯一标识）
- `contributionId`：关联的专业贡献ID（必填）
- `executorId`：执行人ID（必填）
- `executorName`：执行人姓名
- `points`：该执行人的积分（必填，数字）
- `createdAt`：创建时间
- `updatedAt`：更新时间

**业务规则**：
- 一个专业贡献可以有多个执行人（至少一个）
- 每个执行人有独立的积分
- 执行人在立项时添加，审批通过后不能修改（如需修改，需要走变更流程）
- 审批通过后，系统自动为每个执行人创建一条任务

#### ContributionApproval（立项审批记录）

**核心字段**：
- `id`：审批记录ID（唯一标识）
- `contributionId`：关联的专业贡献ID（必填）
- `applicantId`：申请人ID（必填）
- `applicantName`：申请人姓名
- `approverId`：审批人ID（主管，必填）
- `approverName`：审批人姓名
- `status`：审批状态（'pending' | 'approved' | 'rejected'）
- `comment`：审批意见（可选）
- `approvedAt`：审批时间
- `createdAt`：创建时间

**业务规则**：
- 每次立项申请都会创建一条审批记录
- 审批记录不可修改、不可删除（只读）
- 审批通过后，系统自动为每个执行人创建一条任务：
  - 任务名称与专业贡献名称相同
  - 任务执行者就是对应的执行人
  - 任务关联到该专业贡献

#### ContributionAcceptance（验收申请记录）

**核心字段**：
- `id`：验收申请记录ID（唯一标识）
- `contributionId`：关联的专业贡献ID（必填）
- `applicantId`：申请人ID（主管或下属，必填）
- `applicantName`：申请人姓名
- `accepterId`：验收人ID（专人，必填）
- `accepterName`：验收人姓名
- `status`：验收状态（'pending' | 'accepted' | 'rejected'）
- `comment`：验收意见（可选）
- `acceptedAt`：验收时间
- `createdAt`：创建时间

**业务规则**：
- 每次验收申请都会创建一条验收记录
- 验收记录不可修改、不可删除（只读）
- 验收通过后，专业贡献状态变为"已验收通过"

#### ContributionRating（评级记录）

**核心字段**：
- `id`：评级记录ID（唯一标识）
- `contributionId`：关联的专业贡献ID（必填）
- `rating`：评级（'A' | 'B' | 'C'，必填）
- `ratedBy`：评级人ID（总监，必填）
- `ratedByName`：评级人姓名
- `ratedAt`：评级时间
- `createdAt`：创建时间
- `updatedAt`：更新时间

**业务规则**：
- 只有验收通过的专业贡献才能进行评级
- 评级可以随时修改（更新评级记录）
- 评级操作简单，只需要选择A/B/C，不需要记录其他信息

## 二、立项申请规则

### 2.1 立项申请流程

**业务流程**：
1. 员工或主管在专业贡献列表页点击"创建专业贡献"
2. 填写专业贡献基本信息：
   - 专业贡献名称（必填）
   - 专业贡献类别（必填，下拉选择）
   - 专业贡献子类别（必填，根据类别动态加载，如果类别是"其他"，则灵活填写）
   - 立项说明（可选，包含目标、计划、内容框架、交付物等）
   - 立项日期（必填，默认为今天）
3. 添加执行人（至少一个）：
   - 选择执行人（从员工列表中选择）
   - 设置该执行人的积分（必填，数字输入）
   - 支持添加多个执行人，每个执行人单独设置积分
4. 如果由主管帮下属立项，需要选择申请人（下属）
5. 提交后：
   - 如果是员工自行立项：创建专业贡献，状态为"待审批"，系统自动创建立项审批记录，状态为"pending"，等待主管审批
   - 如果是主管帮下属立项：自动完成立项审批，状态直接变为"进行中"
6. 审批通过后（员工自行立项）或自动审批后（主管帮下属立项）：
   - 专业贡献状态直接变为"进行中"
   - 系统自动为每个执行人创建一条任务：
     - 任务名称与专业贡献名称相同
     - 任务执行者就是对应的执行人（`assigneeId = executorId`）
     - 任务关联到该专业贡献（`entityType = 'contribution'`, `entityId = contributionId`）
   - 主管可以为任务分配计划工时

**必填字段**：
- 专业贡献名称：必填，不能为空
- 专业贡献类别：必填，必须选择
- 专业贡献子类别：必填，必须选择（如果类别是"其他"，则灵活填写）
- 执行人列表：必填，至少添加一个执行人，每个执行人必须设置积分
- 立项日期：必填，默认为今天
- 申请人：必填，如果是员工自行立项，默认为当前用户；如果是主管帮下属立项，需要选择下属

**可选字段**：
- 立项说明：可选，文本域，包含目标、计划、内容框架、交付物等

### 2.2 审批规则

**审批权限**：
- 归属部门主管可以审批该部门的专业贡献立项申请
- 主管帮下属立项时，自动完成立项审批，不需要手动审批

**审批操作**：
- 员工自行立项：需要主管审批
  - 审批通过：专业贡献状态直接变为"进行中"，系统自动为每个执行人创建一条任务（任务名称与专业贡献名称相同，任务执行者就是对应的执行人）
  - 审批拒绝：专业贡献状态变为"已拒绝"，可以填写拒绝原因
- 主管帮下属立项：自动完成立项审批，状态直接变为"进行中"，系统自动为每个执行人创建一条任务

**审批意见**：
- 审批意见可选，用于记录审批说明

## 三、任务和工时管理

### 3.1 任务创建

**业务流程**：
1. 专业贡献审批通过后，系统自动为每个执行人创建一条任务
2. 任务创建规则：
   - 任务名称与专业贡献名称相同
   - 任务执行者就是对应的执行人（`assigneeId = executorId`）
   - 任务关联到该专业贡献（`entityType = 'contribution'`, `entityId = contributionId`）
3. 主管可以为任务分配计划工时

**业务规则**：
- 审批通过后，系统自动为每个执行人创建一条任务，不需要手动创建
- 任务名称与专业贡献名称相同
- 每个执行人有自己独立的任务
- 一个专业贡献关联的任务就是自动为执行人创建的任务
- 任务创建后，主管可以分配计划工时
- 任务和工时的详细管理规则已在任务和工时管理模块中说明，这里只形成关联

### 3.2 计划工时分配

**权限**：
- 归属部门主管可以为专业贡献的任务分配计划工时

**业务流程**：
- 主管在专业贡献详情页，查看关联的任务
- 为任务分配计划工时：
  - 选择日期区间
  - 选择分配模式（合计工时模式或每天工时模式）
  - 输入工时（合计工时模式输入总工时，每天工时模式输入每天工时）
- 系统自动排除节假日和周末，根据选择的模式分配工时

### 3.3 实际工时录入

**权限**：
- 任务执行者本人可以录入实际工时

**业务流程**：
- 员工在任务详情页或工时日历视图录入实际工时
- 支持合计工时模式和每天工时模式
- 系统自动排除节假日和周末

**说明**：任务和工时的详细管理规则已在任务和工时管理模块中详细说明，这里只形成关联。

## 四、验收申请规则

### 4.1 验收申请流程

**业务流程**：
1. 申请人或执行人在专业贡献详情页，点击"提交验收申请"
2. 系统验证：专业贡献状态必须是"进行中"（已创建任务）
3. 提交后，创建验收申请记录，状态为"pending"
4. 专业贡献状态变为"待验收"
5. 专人收到验收通知，进行验收确认
6. 验收通过后：
   - 专业贡献状态变为"已验收通过"
   - 总监可以对专业贡献进行评级

**申请权限**：
- 申请人可以发起验收申请
- 执行人列表中的任意执行人都可以发起验收申请

**前置条件**：
- 专业贡献状态必须是"进行中"（已创建任务）

### 4.2 验收确认规则

**验收权限**：
- 专人可以验收确认（具体角色可在审批模块配置）

**验收操作**：
- 验收通过：专业贡献状态变为"已验收通过"，可以填写验收意见
- 验收拒绝：专业贡献状态变为"已拒绝"，可以填写拒绝原因

**验收意见**：
- 验收意见可选，用于记录验收说明

## 五、评级规则

### 5.1 评级流程

**业务流程**：
1. 总监在专业贡献详情页或列表页，查看已验收通过的专业贡献
2. 点击"评级"按钮
3. 选择评级：A（优秀，超出预期）、B（良好，符合预期）、C（一般，勉强通过）
4. 提交后，保存评级记录
5. 评级可以随时修改

**评级权限**：
- 总监可以对已验收通过的专业贡献进行评级

**评级选项**：
- A：优秀，超出预期
- B：良好，符合预期
- C：一般，勉强通过

**业务规则**：
- 只有验收通过的专业贡献才能进行评级
- 评级操作简单，只需要选择A/B/C，不需要记录其他信息
- 评级可以随时修改（更新评级记录）

## 六、状态流转规则

### 6.1 状态流转图

```
待审批 → 进行中 → 待验收 → 已验收通过
  ↓         ↓
已拒绝    已拒绝
```

**状态说明**：
- `pending`：待审批，立项申请已提交，等待主管审批
- `in_progress`：进行中，审批通过后，系统自动创建任务，正在执行
- `acceptance_pending`：待验收，已提交验收申请，等待验收确认
- `accepted`：已验收通过，验收确认通过，可以评级
- `rejected`：已拒绝，立项审批被拒绝或验收被拒绝
- `archived`：已归档

**状态变更规则**：
- 专业贡献创建后，状态默认为"待审批"
- 审批通过后，状态直接变为"进行中"，系统自动为每个执行人创建一条任务
- 提交验收申请后，状态变为"待验收"
- 验收通过后，状态变为"已验收通过"
- 审批拒绝或验收拒绝后，状态变为"已拒绝"
- 已验收通过的专业贡献可以归档

## 七、筛选和查询

### 7.1 筛选条件

**支持的筛选字段**：
- **所属体验组**：按归属部门筛选（下拉选择）
- **专业贡献名称**：按名称模糊搜索（文本输入）
- **类别**：按专业贡献类别筛选（下拉选择）
- **子类别**：按专业贡献子类别筛选（下拉选择）
- **状态**：按专业贡献状态筛选（下拉选择）
- **申请人**：按申请人筛选（下拉选择）
- **评级**：按评级筛选（下拉选择：A/B/C）

**筛选逻辑**：
- 所有筛选条件都是"且"的关系（AND）
- 支持多个筛选条件组合
- 筛选条件改变时，列表自动更新

### 7.2 列表展示

**列表字段**：
- 专业贡献名称
- 类别
- 子类别
- 积分
- 申请人
- 归属部门
- 立项日期
- 状态
- 评级（A/B/C，可为空）
- 操作（查看详情、提交验收、评级等）

**排序规则**：
- 默认按创建时间倒序排列（最新的在前）
- 支持按立项日期、评级等字段排序

## 八、交互设计

### 8.1 专业贡献列表页

**页面布局**：
- **顶部**：筛选条件输入框和按钮
- **列表区域**：专业贡献列表表格
- **操作区域**：创建专业贡献按钮

**筛选区域**：
- 所属体验组：下拉选择器
- 专业贡献名称：文本输入框
- 类别：下拉选择器
- 子类别：下拉选择器
- 状态：下拉选择器
- 申请人：下拉选择器
- 评级：下拉选择器（A/B/C）
- 搜索按钮：执行筛选
- 重置按钮：清空所有筛选条件

**列表操作**：
- 点击专业贡献名称：跳转到专业贡献详情页
- 支持批量操作（如批量导出）

### 8.2 专业贡献详情页

**页面布局**：
- **基本信息区域**：名称、类别、子类别、申请人、归属部门、立项日期、状态、评级
- **执行人列表区域**：显示所有执行人及其积分
- **立项说明区域**：显示立项说明（目标、计划、内容框架、交付物等）
- **审批记录区域**：显示审批记录（审批人、审批时间、审批意见）
- **任务列表区域**：显示该专业贡献关联的所有任务（从任务管理模块获取）
- **验收记录区域**：显示验收记录（验收人、验收时间、验收意见）
- **评级记录区域**：显示评级记录（评级、评级人、评级时间）
- **操作按钮**：提交验收申请、评级、编辑、删除

**任务列表**：
- 显示任务名称、执行者、状态、计划工时、实际工时
- 支持查看任务详情（跳转到任务管理模块）
- 支持分配计划工时（主管权限）

**验收记录列表**：
- 显示验收申请人、验收人、验收时间、验收状态、验收意见
- 按时间倒序排列

**评级记录**：
- 显示当前评级（A/B/C）、评级人、评级时间
- 支持修改评级（总监权限）

### 8.3 创建专业贡献弹窗

**表单字段**：
- 专业贡献名称（必填，文本输入）
- 专业贡献类别（必填，下拉选择）
- 专业贡献子类别（必填，下拉选择或文本输入，根据类别动态加载，如果类别是"其他"，则灵活填写）
- 立项说明（可选，文本域）
- 立项日期（必填，日期选择器，默认为今天）
- 申请人（必填，下拉选择，如果是员工自行立项，默认为当前用户；如果是主管帮下属立项，需要选择下属）
- 执行人列表（必填，至少添加一个执行人）：
  - 执行人（下拉选择，从员工列表中选择）
  - 积分（必填，数字输入，该执行人的积分）
  - 支持添加多个执行人
  - 支持删除执行人（至少保留一个）

**交互流程**：
1. 填写必填字段
2. 添加执行人：
   - 点击"添加执行人"按钮
   - 选择执行人（从员工列表中选择）
   - 设置该执行人的积分（必填）
   - 可以添加多个执行人，每个执行人单独设置积分
3. 可选填写立项说明
4. 如果是主管帮下属立项，选择申请人（下属）
5. 点击"确定"创建专业贡献
6. 创建成功后，状态为"待审批"，等待主管审批

### 8.4 审批弹窗

**表单字段**：
- 专业贡献信息（只读）：名称、类别、子类别、申请人、立项说明
- 执行人列表（只读）：显示所有执行人及其积分
- 审批意见（可选，文本域）
- 审批操作（必选）：通过/拒绝

**交互流程**：
1. 查看专业贡献信息（包括名称、类别、子类别、申请人、立项说明）
2. 查看执行人列表（包括每个执行人及其积分）
3. 填写审批意见（可选）
4. 选择审批操作（通过/拒绝）
5. 点击"确定"提交审批
6. 审批通过后，系统自动为每个执行人创建一条任务（任务名称与专业贡献名称相同，任务执行者就是对应的执行人），状态直接变为"进行中"

### 8.5 验收申请弹窗

**表单字段**：
- 专业贡献信息（只读）：名称、类别、子类别、申请人、状态
- 验收说明（可选，文本域）

**交互流程**：
1. 查看专业贡献信息
2. 填写验收说明（可选）
3. 点击"确定"提交验收申请
4. 提交成功后，状态变为"待验收"，等待专人验收确认

### 8.6 验收确认弹窗

**表单字段**：
- 专业贡献信息（只读）：名称、类别、子类别、申请人、立项说明
- 任务信息（只读）：显示关联的任务和工时信息
- 验收意见（可选，文本域）
- 验收操作（必选）：通过/拒绝

**交互流程**：
1. 查看专业贡献信息和任务信息
2. 填写验收意见（可选）
3. 选择验收操作（通过/拒绝）
4. 点击"确定"提交验收确认
5. 验收通过后，状态变为"已验收通过"，可以评级

### 8.7 评级弹窗

**表单字段**：
- 专业贡献信息（只读）：名称、类别、子类别、申请人
- 当前评级（只读，如果已评级）
- 评级（必选，下拉选择：A/B/C）

**交互流程**：
1. 查看专业贡献信息
2. 查看当前评级（如果已评级）
3. 选择评级（A/B/C）
4. 点击"确定"保存评级
5. 评级可以随时修改

## 九、权限控制规则

### 9.1 专业贡献管理权限

**创建权限**：
- 员工可以自行创建专业贡献（申请人默认为自己）
- 归属部门主管可以帮下属创建专业贡献（选择申请人）

**编辑权限**：
- 只有状态为"待审批"的专业贡献可以编辑
- 申请人可以编辑自己创建的专业贡献
- 归属部门主管可以编辑该部门的专业贡献

**删除权限**：
- 只有状态为"待审批"或"已拒绝"的专业贡献可以删除
- 申请人可以删除自己创建的专业贡献
- 归属部门主管可以删除该部门的专业贡献（建议软删除，保留历史记录）

**查看权限**：
- 所有用户都可以查看专业贡献列表和详情
- 可以根据部门权限限制查看范围

### 9.2 审批权限

**审批权限**：
- 归属部门主管可以审批该部门的专业贡献立项申请

**查看审批记录权限**：
- 所有有查看专业贡献权限的用户都可以查看审批记录

### 9.3 验收权限

**提交验收申请权限**：
- 申请人可以提交验收申请
- 执行人列表中的任意执行人都可以提交验收申请

**验收确认权限**：
- 专人可以验收确认（具体角色可在审批模块配置）

**查看验收记录权限**：
- 所有有查看专业贡献权限的用户都可以查看验收记录

### 9.4 评级权限

**评级权限**：
- 总监可以对已验收通过的专业贡献进行评级
- 评级可以随时修改

**查看评级权限**：
- 所有有查看专业贡献权限的用户都可以查看评级

### 9.5 任务管理权限

**任务创建权限**：
- 专业贡献审批通过后，系统自动为每个执行人创建一条任务
- 任务名称与专业贡献名称相同
- 每个执行人有自己独立的任务

**分配计划工时权限**：
- 归属部门主管可以为专业贡献的任务分配计划工时

**录入实际工时权限**：
- 任务执行者本人可以录入实际工时

**说明**：任务和工时的详细权限规则已在任务和工时管理模块中详细说明，这里只形成关联。

## 十、总结

专业贡献模块的核心逻辑是：
1. **立项申请**：员工可以自行立项，主管也可以帮下属立项，需要主管审批；积分由申请人在立项时填写，灵活设置
2. **审批流程**：主管审批通过后，状态直接变为"进行中"，系统自动为每个执行人创建一条任务（任务名称与专业贡献名称相同，任务执行者就是对应的执行人）
3. **任务和工时**：任务和工时管理已在任务和工时管理模块中详细说明，这里只形成关联
4. **验收申请**：申请人或执行人可以发起验收申请，由专人验收确认
5. **评级管理**：总监可以对已验收通过的专业贡献进行评级（A/B/C），可以随时修改

主要特点：
1. 专业贡献由员工自行立项或主管帮下属立项，需要主管审批
2. 积分由申请人在立项时填写，灵活设置
3. 专业贡献类别包括：专项调研、案例文章、演讲分享、专项研讨、创方法、其他
4. 审批通过后，状态直接变为"进行中"，系统自动为每个执行人创建一条任务（任务名称与专业贡献名称相同，任务执行者就是对应的执行人）
5. 任务和工时管理通过任务管理模块实现，这里只形成关联
6. 验收流程简化，只需要提交验收申请和验收确认
7. 评级操作简单，只需要选择A/B/C，可以随时修改
8. 支持多维度筛选和统计，便于管理和分析

