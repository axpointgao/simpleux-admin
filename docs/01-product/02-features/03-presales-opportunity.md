# 售前支持模块功能需求

## 一、功能概述

售前支持模块用于管理售前商机的全生命周期，包括商机创建、跟进记录、成本管理（人力、差旅、外包）、任务和工时管理等功能。

## 二、功能列表

### 2.1 商机创建

**功能描述**：
- 支持创建售前支持商机
- 商机包含基本信息、支持类型、预估金额等信息
- 商机创建后可以关联任务和记录成本

**功能要求**：

1. **基本信息录入**：
   - 商机名称（必填，文本输入）
   - 创建日期（必填，日期选择器，默认为今天）
   - 负责人（必填，下拉选择）
   - 归属部门（必填，下拉选择）
   - 商务经理（可选，文本输入）
   - 客户部（必填，下拉选择）

2. **商机信息录入**：
   - 商机状态（必填，下拉选择：进行中/赢单/输单/沉默/放弃）
   - 赢单概率（可选，下拉选择：High/Medium/Low）
   - 预估金额（可选，数字输入，单位：元）
   - 支持类型（必填，多选：评估报价/投标配合/POC方案/交流分享）

3. **创建流程**：
   - 填写必填字段
   - 提交后创建商机
   - 创建成功后跳转到商机详情页

**交互设计**：
- 商机创建表单使用单页表单
- 支持保存草稿
- 表单验证和错误提示

### 2.2 商机列表

**功能描述**：
- 显示所有售前支持商机列表
- 支持多维度筛选和搜索
- 支持排序和分页

**功能要求**：

1. **列表字段**：
   - 商机名称
   - 负责人
   - 归属部门
   - 客户部
   - 商机状态
   - 赢单概率
   - 预估金额
   - 创建时间
   - 操作按钮（查看详情、编辑、删除）

2. **筛选条件**：
   - 商机状态（下拉选择，多选）
   - 赢单概率（下拉选择，多选）
   - 归属部门（下拉选择，多选）
   - 客户部（下拉选择，多选）
   - 负责人（下拉选择，多选）
   - 商机名称（文本输入，模糊搜索）
   - 创建时间（日期范围选择器）

3. **排序**：
   - 默认按创建时间倒序
   - 支持按预估金额、创建时间等字段排序

4. **分页**：
   - 每页显示20条记录
   - 支持跳转到指定页码

**交互设计**：
- 列表使用表格展示
- 筛选条件在列表顶部，支持展开/收起
- 支持批量操作（如批量导出）

### 2.3 商机详情

**功能描述**：
- 显示商机的完整信息
- 支持编辑商机基本信息
- 支持查看和管理跟进记录、成本、任务等

**功能要求**：

1. **基本信息区域**：
   - 商机名称、创建日期、负责人、归属部门、商务经理、客户部
   - 商机状态、赢单概率、预估金额、支持类型
   - 操作按钮（编辑、删除）

2. **跟进记录区域**：
   - 显示所有跟进记录
   - 跟进日期、商机状态、赢单概率、预估金额、支持类型、跟进备注
   - 操作按钮（创建跟进记录、查看详情、编辑、删除）

3. **成本管理区域**：
   - 人力成本列表（从任务工时自动计算）
   - 差旅成本列表（手动录入）
   - 外包成本列表（手动录入）
   - 成本汇总（总成本金额）
   - 操作按钮（添加差旅成本、添加外包成本、编辑、删除）

4. **任务列表区域**：
   - 显示商机关联的所有任务
   - 任务名称、执行者、状态、计划工时、实际工时
   - 操作按钮（创建任务、查看详情）

5. **成本分析区域**：
   - 成本明细（人力、差旅、外包）
   - 成本趋势图表（按月份）
   - 成本占比分析

**交互设计**：
- 使用标签页组织不同区域的内容
- 支持展开/收起各个区域
- 支持跳转到相关模块（如任务管理）

### 2.4 跟进记录管理

**功能描述**：
- 支持创建和管理商机跟进记录
- 跟进记录包含商机状态、赢单概率、预估金额、支持类型、跟进备注等信息

**功能要求**：

1. **创建跟进记录**：
   - 跟进日期（必填，日期选择器，默认为今天）
   - 商机状态（必填，下拉选择）
   - 赢单概率（可选，下拉选择）
   - 预估金额（可选，数字输入）
   - 支持类型（必填，多选）
   - 跟进备注（必填，文本域）
   - 提交后创建跟进记录

2. **跟进记录管理**：
   - 查看跟进记录列表（按时间倒序）
   - 编辑跟进记录（可选）
   - 删除跟进记录（可选）

3. **跟进统计**：
   - 跟进记录数量
   - 状态变更历史
   - 跟进频率统计

**交互设计**：
- 跟进记录使用时间线展示
- 支持按日期筛选
- 支持快速创建跟进记录

### 2.5 成本管理

**功能描述**：
- 管理商机的人力成本、差旅成本、外包成本
- 人力成本从任务工时自动计算
- 差旅和外包成本手动录入

**功能要求**：

1. **人力成本管理**：
   - 从任务工时自动计算
   - 按月份显示人力成本
   - 支持查看人力成本明细

2. **差旅成本管理**：
   - 手动录入差旅成本
   - 录入月份（必填，日期选择器）
   - 录入差旅事项（必填，文本输入）
   - 录入各项费用（大交通、住宿、小交通、餐补、其他）
   - 系统自动计算总价

3. **外包成本管理**：
   - 手动录入外包成本
   - 录入月份（必填，日期选择器）
   - 录入外包事项（必填，文本输入）
   - 选择供应商（必填，下拉选择）
   - 录入金额（必填，数字输入）

4. **成本统计**：
   - 总成本金额
   - 按月份统计成本
   - 成本明细（人力、差旅、外包）

**交互设计**：
- 成本管理使用表格展示
- 支持按月份筛选
- 支持批量操作

### 2.6 任务管理

**功能描述**：
- 支持为商机创建任务
- 任务关联到商机，用于工时管理
- 任务管理功能在任务和工时管理模块中实现

**功能要求**：

1. **任务创建**：
   - 在商机详情页创建任务
   - 任务名称、任务描述、执行者
   - 任务关联到商机（`entityType = 'presales_opportunity'`）

2. **任务列表**：
   - 显示商机关联的所有任务
   - 任务名称、执行者、状态、计划工时、实际工时
   - 支持跳转到任务详情页

3. **工时管理**：
   - 计划工时分配（主管权限）
   - 实际工时录入（执行者权限）
   - 工时统计和分析

**交互设计**：
- 任务列表在商机详情页显示
- 支持创建任务按钮
- 支持跳转到任务管理模块

## 三、功能优先级

### 3.1 P0（必须实现）

- 商机创建
- 商机列表
- 商机详情
- 跟进记录管理
- 成本管理（人力、差旅、外包）

### 3.2 P1（重要功能）

- 任务管理
- 成本分析
- 批量操作

### 3.3 P2（可选功能）

- 商机报表
- 商机分析
- 商机导出

## 四、验收标准

### 4.1 功能验收

- 所有P0功能必须完整实现
- 所有P1功能必须完整实现
- 功能符合业务逻辑规则文档要求
- 成本计算准确

### 4.2 性能验收

- 商机列表加载时间 < 2秒
- 商机详情加载时间 < 1秒
- 成本统计数据计算准确

### 4.3 用户体验验收

- 界面友好，操作流畅
- 错误提示清晰
- 支持响应式设计
- 跟进记录时间线展示清晰

