# 任务和工时管理模块功能需求

## 一、功能概述

任务和工时管理模块是一个通用的任务和工时管理系统，支持为商业项目、售前支持、专业贡献、其他任务等业务实体创建任务，并支持计划工时分配和实际工时录入。

## 二、功能列表

### 2.1 任务创建

**功能描述**：
- 支持为不同业务实体创建任务
- 任务可以关联到商业项目、售前支持、专业贡献、其他任务
- 任务创建后状态默认为"进行中"

**功能要求**：

1. **任务基本信息录入**：
   - 任务名称（必填，文本输入）
   - 任务描述（可选，文本域）
   - 任务执行人（必填，下拉选择）
   - 开始日期（可选，日期选择器）
   - 结束日期（可选，日期选择器）
   - 优先级（可选，下拉选择：low/medium/high）

2. **任务关联**：
   - 任务自动关联到业务实体（通过`entityType`和`entityId`）
   - 在业务实体详情页创建任务时，自动设置关联关系

3. **任务创建权限**：
   - 商业项目：项目归属部门主管或项目经理
   - 售前支持：归属部门主管
   - 专业贡献：系统自动创建（审批通过后）
   - 其他任务：归属部门主管

4. **创建流程**：
   - 填写任务基本信息
   - 提交后创建任务
   - 任务状态默认为"进行中"

**交互设计**：
- 任务创建表单使用弹窗或页面
- 表单验证和错误提示
- 支持快速创建（简化表单）

### 2.2 任务列表

**功能描述**：
- 显示任务列表
- 支持多维度筛选和搜索
- 支持排序和分页

**功能要求**：

1. **列表字段**：
   - 任务名称
   - 关联业务实体（项目/商机/专业贡献/其他任务）
   - 执行者
   - 任务状态
   - 计划工时（总工时）
   - 实际工时（总工时）
   - 工时完成率
   - 创建时间
   - 操作按钮（查看详情、编辑、删除）

2. **筛选条件**：
   - 任务状态（下拉选择，多选）
   - 关联业务实体类型（下拉选择，多选）
   - 执行者（下拉选择，多选）
   - 归属部门（下拉选择，多选）
   - 任务名称（文本输入，模糊搜索）
   - 创建时间（日期范围选择器）

3. **排序**：
   - 默认按创建时间倒序
   - 支持按计划工时、实际工时、创建时间等字段排序

4. **分页**：
   - 每页显示20条记录
   - 支持跳转到指定页码

**交互设计**：
- 列表使用表格展示
- 筛选条件在列表顶部，支持展开/收起
- 支持批量操作（如批量导出）

### 2.3 任务详情

**功能描述**：
- 显示任务的完整信息
- 支持查看和管理计划工时、实际工时
- 支持工时统计和分析

**功能要求**：

1. **基本信息区域**：
   - 任务名称、任务描述、执行者、创建者、创建时间、状态
   - 关联业务实体信息
   - 操作按钮（编辑、删除、完成、取消）

2. **计划工时列表**：
   - 按日期显示计划工时
   - 显示分配模式（合计工时模式/每天工时模式）
   - 显示总计划工时和每天计划工时
   - 操作按钮（添加计划工时、编辑、删除）

3. **实际工时列表**：
   - 按日期显示实际工时
   - 显示录入模式（合计工时模式/每天工时模式）
   - 显示总实际工时和每天实际工时
   - 操作按钮（录入实际工时、编辑、删除）

4. **工时统计**：
   - 总计划工时、总实际工时、工时差异、完成率
   - 工时对比图表（计划工时 vs 实际工时）
   - 按日期统计工时

**交互设计**：
- 使用标签页组织不同区域的内容
- 支持展开/收起各个区域
- 支持跳转到关联业务实体

### 2.4 计划工时分配

**功能描述**：
- 支持为任务分配计划工时
- 支持两种分配模式：合计工时模式和每天工时模式
- 系统自动排除节假日和周末

**功能要求**：

1. **分配模式选择**：
   - **合计工时模式**：输入总计划工时，系统自动均分到每个工作日
   - **每天工时模式**：输入每天计划工时，系统为每个工作日分配相同工时

2. **日期区间选择**：
   - 开始日期（必填，日期选择器）
   - 结束日期（必填，日期选择器）
   - 系统自动计算工作日数量（排除节假日和周末）

3. **工时输入**：
   - 合计工时模式：输入总计划工时（小时，支持小数）
   - 每天工时模式：输入每天计划工时（小时，支持小数）

4. **自动计算**：
   - 合计工时模式：系统自动计算每天计划工时
   - 每天工时模式：系统自动计算总计划工时

5. **分配权限**：
   - 商业项目：项目归属部门主管或项目经理
   - 售前支持：归属部门主管
   - 专业贡献：归属部门主管
   - 其他任务：归属部门主管

**交互设计**：
- 计划工时分配弹窗
- 显示工作日数量（只读）
- 显示计算结果（只读）
- 支持预览分配结果

### 2.5 实际工时录入

**功能描述**：
- 支持任务执行者录入实际工时
- 支持两种录入模式：合计工时模式和每天工时模式
- 系统自动排除节假日和周末

**功能要求**：

1. **录入模式选择**：
   - **合计工时模式**：输入总工时，系统自动均分到每个工作日
   - **每天工时模式**：输入每天工时，系统为每个工作日录入相同工时

2. **日期区间选择**：
   - 开始日期（必填，日期选择器）
   - 结束日期（必填，日期选择器）
   - 系统自动计算工作日数量（排除节假日和周末）

3. **工时输入**：
   - 合计工时模式：输入总工时（小时，支持小数，>= 0）
   - 每天工时模式：输入每天工时（小时，支持小数，>= 0）

4. **自动计算**：
   - 合计工时模式：系统自动计算每天实际工时和总实际工时
   - 每天工时模式：系统自动计算总实际工时

5. **录入权限**：
   - 只能由任务执行者本人录入
   - 执行者只能录入自己任务的工时

**交互设计**：
- 实际工时录入弹窗
- 显示工作日数量（只读）
- 显示计算结果（只读）
- 支持预览录入结果

### 2.6 工时日历视图

**功能描述**：
- 提供直观的日历视图展示工时分布
- 支持月视图、周视图、日视图
- 支持多维度筛选

**功能要求**：

1. **视图类型**：
   - **月视图**：显示一个月的计划工时和实际工时
   - **周视图**：显示一周的计划工时和实际工时
   - **日视图**：显示一天的计划工时和实际工时

2. **显示内容**：
   - 日期和星期
   - 计划工时（如果有）
   - 实际工时（如果有）
   - 工时差异（实际工时 - 计划工时）
   - 任务信息（关联的任务名称和执行人）

3. **筛选功能**：
   - 按任务筛选
   - 按执行人筛选
   - 按业务实体筛选
   - 按部门筛选
   - 切换计划工时/实际工时视图

4. **交互操作**：
   - 点击日期：查看当天的详细工时信息
   - 点击任务：查看任务的详细信息
   - 在日历中录入：点击日期，弹出实际工时录入弹窗
   - 切换视图：在月视图、周视图、日视图之间切换
   - 切换月份/周：查看不同时间段的数据

5. **颜色标识**：
   - 计划工时：蓝色标识
   - 实际工时：绿色标识
   - 工时差异：实际工时 > 计划工时（红色），实际工时 < 计划工时（黄色），实际工时 = 计划工时（绿色）
   - 节假日：灰色标识，不显示工时

**交互设计**：
- 日历视图使用日历组件
- 支持横向和纵向滚动
- 支持快速跳转到今天
- 支持批量填报工时

### 2.7 工时统计

**功能描述**：
- 支持多维度工时统计
- 支持工时对比分析
- 支持工时报表导出

**功能要求**：

1. **统计维度**：
   - 按任务统计：每个任务的计划工时、实际工时、完成率
   - 按执行人统计：每个执行者的计划工时、实际工时、完成率
   - 按业务实体统计：每个业务实体的计划工时、实际工时
   - 按日期区间统计：指定日期区间内的计划工时、实际工时
   - 按部门统计：部门的计划工时、实际工时

2. **统计指标**：
   - 计划工时总数
   - 实际工时总数
   - 工时完成率（实际工时 / 计划工时 × 100%）
   - 工时差异（实际工时 - 计划工时）

3. **对比分析**：
   - 计划工时 vs 实际工时对比
   - 按天对比：每天的计划工时和实际工时对比
   - 按周对比：每周的计划工时和实际工时对比
   - 按月对比：每月的计划工时和实际工时对比

4. **报表导出**：
   - 支持导出Excel格式
   - 支持导出PDF格式
   - 支持自定义报表字段

**交互设计**：
- 统计页面使用图表和表格展示
- 支持筛选条件
- 支持导出按钮

## 三、功能优先级

### 3.1 P0（必须实现）

- 任务创建
- 任务列表
- 任务详情
- 计划工时分配
- 实际工时录入

### 3.2 P1（重要功能）

- 工时日历视图
- 工时统计
- 批量操作

### 3.3 P2（可选功能）

- 工时报表
- 工时分析
- 工时导出

## 四、验收标准

### 4.1 功能验收

- 所有P0功能必须完整实现
- 所有P1功能必须完整实现
- 功能符合业务逻辑规则文档要求
- 两种分配模式正确实现
- 节假日排除功能正确实现

### 4.2 性能验收

- 任务列表加载时间 < 2秒
- 任务详情加载时间 < 1秒
- 工时日历视图加载时间 < 2秒
- 工时统计数据计算准确

### 4.3 用户体验验收

- 界面友好，操作流畅
- 错误提示清晰
- 支持响应式设计
- 日历视图展示清晰直观

