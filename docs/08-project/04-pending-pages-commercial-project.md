# 商业项目管理模块待完成页面清单

## 一、已完成的页面

### ✅ 已完成
1. **项目列表页** (`/projects/list`)
   - 路径：`simpleux-admin/src/pages/projects/list/index.tsx`
   - 状态：✅ 已完成
   - 功能：列表展示、筛选、分页、详情抽屉

2. **项目创建页** (`/projects/create`)
   - 路径：`simpleux-admin/src/pages/projects/create/index.tsx`
   - 状态：✅ 已完成（⚠️ 待优化：需要实现分步骤向导）
   - 功能：项目创建表单、类型选择、预算录入、交付计划

3. **项目详情抽屉** (在列表页中)
   - 路径：`simpleux-admin/src/pages/projects/list/detail-drawer.tsx`
   - 状态：✅ 已完成
   - 功能：基本信息、预算明细、支出明细、变更记录、阶段管理

4. **阶段进度管理弹窗** (在详情抽屉中)
   - 路径：`simpleux-admin/src/pages/projects/list/stage-progress-modal.tsx`
   - 状态：✅ 已完成
   - 功能：阶段状态操作、完成百分比设置、附件上传

---

## 二、待完成的页面

### P0（必须实现）

#### 1. 项目变更申请页面/弹窗
**功能描述**：
- 支持项目信息变更申请
- 变更需要审批
- 记录变更历史

**功能要求**：
- 选择变更类型（项目变更/需求变更，计件制项目需要选择）
- 填写变更说明（必填）
- 上传变更附件（必填）
- 可变更字段：
  - 项目制：项目名称、项目经理、归属部门、商务经理、归属客户部、计划开始/结束日期、业绩金额、阶段、预算
  - 计件制主项目变更：框架协议相关信息（项目经理、归属部门、商务经理、归属客户部）
  - 计件制需求变更：需求名称、计划时间、业绩金额、阶段、预算
- 提交审批

**交互设计**：
- 可以使用弹窗（Modal）或独立页面
- 变更申请使用表单
- 变更记录在详情页的"变更记录"Tab中显示

**优先级**：P0

**当前状态**：
- 详情页有"项目变更"按钮，但功能未实现（显示"项目变更功能开发中"）
- 变更记录Tab已实现，但数据为空

---

#### 2. 项目补录申请页面/弹窗
**功能描述**：
- 计件制项目支持补录申请
- 补录申请需要审批
- 审批通过后，可以录入预算和业绩金额

**功能要求**：
- 填写补录说明（必填）
- 上传补录附件（必填）
- 填写需求金额（必填，必须 > 0）
- 选择阶段模板（必填，如果之前没有选择阶段模板）
- 录入预算：人力预算必填，差旅和外包可选
- 阶段占比验证：所有阶段占比之和必须等于100%
- 提交审批

**交互设计**：
- 可以使用弹窗（Modal）或独立页面
- 补录申请使用表单
- 补录记录在详情页显示

**优先级**：P0

**当前状态**：
- 详情页有"提交补录申请"按钮，但功能未实现（显示"提交补录申请功能开发中"）
- 列表页操作菜单中有"提交补录申请"选项，但功能未实现

---

#### 3. 预算管理页面/弹窗
**功能描述**：
- 管理项目的人力预算、差旅预算、外包预算
- 支持添加、编辑、删除预算项
- 自动计算预算总额

**功能要求**：
- 人力预算管理：
  - 按员工级别（P0-P9, M0-M5）和城市类型（成都/杭州）录入人日数
  - 系统自动根据人日成本标准计算单价和总价
  - 支持批量导入和导出
- 差旅预算管理：
  - 录入差旅事项
  - 录入各项费用（大交通、住宿、小交通、补助、其他）
  - 系统自动计算总价
- 外包预算管理：
  - 录入外包事项
  - 选择供应商
  - 录入金额
- 预算汇总（总预算金额）

**交互设计**：
- 可以在详情页的"人力明细"、"差旅明细"、"外包明细"Tab中实现
- 或者使用独立的预算管理弹窗
- 预算管理使用表格展示
- 支持行内编辑
- 支持批量操作

**优先级**：P0

**当前状态**：
- 详情页已显示预算明细表格，但只有查看功能
- 缺少添加、编辑、删除预算的功能
- 缺少批量导入/导出功能

---

#### 4. 支出管理页面/弹窗
**功能描述**：
- 管理项目的人力支出、差旅支出、外包支出
- 人力支出从Teambition同步或手动录入
- 差旅和外包支出手动录入

**功能要求**：
- 人力支出管理：
  - 从Teambition同步工时数据
  - 系统自动根据工时和人日成本标准计算成本
  - 支持手动录入和编辑
- 差旅支出管理：
  - 手动录入差旅事项和各项费用
  - 支持上传差旅凭证
- 外包支出管理：
  - 手动录入外包事项、供应商和金额
  - 支持上传外包合同或发票
- 支出汇总（总支出金额）
- 支持按月份筛选
- 支持导出支出明细

**交互设计**：
- 可以在详情页的"人力明细"、"差旅明细"、"外包明细"Tab中实现
- 或者使用独立的支出管理弹窗
- 支出管理使用表格展示
- 支持按月份筛选

**优先级**：P0

**当前状态**：
- 详情页已显示支出明细表格，但只有查看功能
- 缺少添加、编辑、删除支出的功能
- 缺少从Teambition同步工时的功能
- 缺少上传凭证/合同/发票的功能
- 详情页有"录入支出"按钮，但功能未实现（显示"录入支出功能开发中"）

---

### P1（重要功能）

#### 5. 设计确认申请页面/弹窗
**功能描述**：
- 项目完成后，需要设计确认
- 设计确认需要审批
- 记录设计确认历史

**功能要求**：
- 填写设计确认说明（可选）
- 上传设计确认附件（可选，但文档要求必填）
- 提交审批

**交互设计**：
- 可以使用弹窗（Modal）
- 设计确认申请使用表单
- 设计确认记录在详情页显示

**优先级**：P1

**当前状态**：
- 详情页有"发起设计确认"按钮，但功能未实现（显示"发起设计确认功能开发中"）

---

#### 6. 项目归档页面/弹窗
**功能描述**：
- 项目完成后，可以归档
- 归档后的项目默认隐藏
- 归档时重新计算实际利润

**功能要求**：
- 归档前预算与支出核对：
  - 系统自动检查：如果有差旅预算或外包预算，但没有对应的支出记录
  - 如果存在预算但无支出，显示提示信息，要求用户核对确认
- 归档操作：
  - 确认项目已完成
  - 填写归档说明（可选）
  - 点击归档按钮
  - 提交审批
- 归档审批：
  - 根据审批流程配置进行审批
  - 审批通过后，根据实际支出重新计算实际利润
  - 项目状态变为"已归档"
  - 项目默认隐藏（不显示在列表中）
- 取消归档：
  - 已归档项目可以取消归档
  - 不需要审批，直接取消归档
  - 项目状态变为"已确认"

**交互设计**：
- 可以使用弹窗（Modal）或确认对话框
- 归档操作需要确认对话框
- 归档后的项目在列表中标记为"已归档"

**优先级**：P1

**当前状态**：
- 详情页有"发起归档"按钮，但功能未实现（显示"发起归档功能开发中"）
- 详情页有"取消归档"按钮，但功能未实现（只有确认对话框，没有实际API调用）

---

#### 7. 成本分析页面/区域
**功能描述**：
- 预算成本 vs 实际成本对比图表
- 利润分析（合同金额 - 总成本）
- 成本明细（人力、差旅、外包）

**功能要求**：
- 预算成本 vs 实际成本对比图表
- 利润分析（合同金额 - 总成本）
- 成本明细（人力、差旅、外包）

**交互设计**：
- 可以在详情页添加"成本分析"Tab
- 使用图表展示预算 vs 实际成本对比
- 显示利润分析

**优先级**：P1

**当前状态**：
- 详情页没有成本分析区域
- 需要添加成本分析Tab和图表

---

### P2（可选功能）

#### 8. 项目编辑页面
**功能描述**：
- 编辑项目基本信息
- 编辑预算和交付计划

**功能要求**：
- 支持编辑项目基本信息
- 支持编辑预算（人力、差旅、外包）
- 支持编辑交付计划（阶段）

**交互设计**：
- 可以复用项目创建页面，通过URL参数区分创建/编辑模式
- 或者使用独立的编辑页面

**优先级**：P2

**当前状态**：
- 项目创建页面已支持编辑模式（通过URL参数 `id` 判断）
- 但编辑功能未完全实现（需要加载现有数据）

---

#### 9. 框架协议管理页面
**功能描述**：
- 创建和管理框架协议（主项目）
- 用于计件制项目关联

**功能要求**：
- 创建框架协议
- 编辑框架协议
- 框架协议列表
- 框架协议详情

**交互设计**：
- 可以使用独立页面或弹窗
- 在项目创建页的"框架协议"选择器中，有"创建框架协议"按钮，但功能未实现

**优先级**：P2

**当前状态**：
- 项目创建页有"创建框架协议"按钮，但功能未实现（显示"创建框架协议功能待实现"）

---

#### 10. 批量导入/导出功能
**功能描述**：
- 批量导入项目
- 批量导出项目
- 批量导入预算
- 批量导出预算/支出

**功能要求**：
- 批量导入项目（Excel）
- 批量导出项目（Excel）
- 批量导入预算（Excel）
- 批量导出预算/支出（Excel）

**交互设计**：
- 在列表页添加"批量导入"和"批量导出"按钮
- 在预算管理中添加"批量导入"和"批量导出"按钮

**优先级**：P2

**当前状态**：
- 未实现

---

## 三、页面实现优先级总结

### P0（必须实现）- 4个页面/功能
1. ✅ 项目变更申请页面/弹窗
2. ✅ 项目补录申请页面/弹窗
3. ✅ 预算管理功能（添加/编辑/删除预算）
4. ✅ 支出管理功能（添加/编辑/删除支出、同步工时）

### P1（重要功能）- 3个页面/功能
5. ✅ 设计确认申请页面/弹窗
6. ✅ 项目归档页面/弹窗（包含预算与支出核对）
7. ✅ 成本分析页面/区域

### P2（可选功能）- 3个页面/功能
8. ⚠️ 项目编辑页面（部分实现，需要完善）
9. ⚠️ 框架协议管理页面
10. ⚠️ 批量导入/导出功能

---

## 四、实现建议

### 1. 弹窗 vs 独立页面
- **项目变更申请**：建议使用弹窗（Modal），因为变更内容与项目创建表单类似
- **项目补录申请**：建议使用弹窗（Modal），因为补录内容与项目创建表单类似
- **预算管理**：建议在详情页Tab中实现，添加"添加"、"编辑"、"删除"按钮
- **支出管理**：建议在详情页Tab中实现，添加"添加"、"编辑"、"删除"、"同步工时"按钮
- **设计确认申请**：建议使用弹窗（Modal），内容简单
- **项目归档**：建议使用弹窗（Modal），包含预算与支出核对流程
- **成本分析**：建议在详情页添加新的Tab

### 2. 技术实现
- 使用 Arco Design 的 Modal、Drawer、Form 组件
- 复用项目创建页面的表单组件和验证逻辑
- 预算和支出管理可以在详情页Tab中实现，使用 Table 的行内编辑或弹窗编辑

### 3. 数据接口
- 需要实现以下API接口：
  - 项目变更申请API
  - 项目补录申请API
  - 预算增删改API
  - 支出增删改API
  - Teambition同步工时API
  - 设计确认申请API
  - 项目归档API
  - 成本分析数据API

---

## 五、当前开发进度

### 已完成（约40%）
- ✅ 项目列表页
- ✅ 项目创建页（单页表单，待优化为分步骤向导）
- ✅ 项目详情抽屉（查看功能完整）
- ✅ 阶段进度管理

### 待完成（约60%）
- ❌ 项目变更申请
- ❌ 项目补录申请
- ❌ 预算管理（增删改）
- ❌ 支出管理（增删改、同步工时）
- ❌ 设计确认申请
- ❌ 项目归档（包含预算与支出核对）
- ❌ 成本分析
- ⚠️ 项目编辑（部分实现）
- ⚠️ 框架协议管理
- ⚠️ 批量导入/导出

---

## 六、下一步开发建议

### 第一阶段（P0功能）
1. 实现项目变更申请弹窗
2. 实现项目补录申请弹窗
3. 实现预算管理功能（在详情页Tab中添加增删改功能）
4. 实现支出管理功能（在详情页Tab中添加增删改功能、同步工时）

### 第二阶段（P1功能）
5. 实现设计确认申请弹窗
6. 实现项目归档弹窗（包含预算与支出核对流程）
7. 实现成本分析Tab（在详情页添加）

### 第三阶段（P2功能）
8. 完善项目编辑功能
9. 实现框架协议管理页面
10. 实现批量导入/导出功能

