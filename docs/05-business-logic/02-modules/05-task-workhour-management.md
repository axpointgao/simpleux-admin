# 任务和工时管理模块业务逻辑规则

## 一、数据模型

### 1.1 核心实体

#### Task（任务）

**任务状态（`status`）**：
- `in_progress`：进行中（默认状态，任务创建后即为进行中）
- `completed`：已完成
- `cancelled`：已取消

**任务类型（`entityType`）**：
- `commercial_project`：商业项目
- `presales_opportunity`：售前支持
- `contribution`：专业贡献
- `other_task`：其他任务

**核心字段**：
- `id`：任务ID（唯一标识）
- `name`：任务名称（必填）
- `description`：任务描述（可选）
- `entityType`：关联实体类型（必填）
- `entityId`：关联实体ID（必填）
- `assigneeId`：任务执行人ID（必填）
- `assigneeName`：任务执行人姓名
- `status`：任务状态（默认：`in_progress`）
- `priority`：优先级（'low' | 'medium' | 'high'，可选）
- `startDate`：开始日期（可选）
- `endDate`：结束日期（可选）
- `createdBy`：创建人ID（必填）
- `createdByName`：创建人姓名
- `createdAt`：创建时间
- `updatedAt`：更新时间

**业务规则**：
- 任务创建后，状态默认为"进行中"（`in_progress`）
- 任务可以关联到不同的业务实体（商业项目、售前支持、专业贡献、其他任务）
- 任务执行人可以录入实际工时
- 只有任务执行人本人可以录入实际工时
- 任务完成后，状态变为"已完成"
- 任务可以取消，状态变为"已取消"

**关联关系**：
- 一个任务关联一个业务实体（通过`entityType`和`entityId`）
- 一个任务可以有多个计划工时分配记录
- 一个任务可以有多个实际工时记录

#### PlannedWorkHour（计划工时）

**分配模式（`allocationMode`）**：
- `total_hours`：合计工时模式（在指定日期区间内分配总工时）
- `daily_hours`：每天工时模式（在指定日期区间内每天固定工时）

**核心字段**：
- `id`：计划工时ID（唯一标识）
- `taskId`：关联的任务ID（必填）
- `startDate`：开始日期（必填）
- `endDate`：结束日期（必填）
- `allocationMode`：分配模式（必填：'total_hours' | 'daily_hours'）
- `totalHours`：总工时（合计工时模式必填）
- `dailyHours`：每天工时（每天工时模式必填）
- `allocatedHours`：已分配工时（系统计算，按工作日分配）
- `allocatedDetails`：分配明细（JSON格式，记录每天分配的工时）
- `createdBy`：创建人ID（必填）
- `createdByName`：创建人姓名
- `createdAt`：创建时间
- `updatedAt`：更新时间

**业务规则**：
- 计划工时分配时，系统自动排除周末和节假日
- 合计工时模式：在指定日期区间内，将总工时平均分配到每个工作日
- 每天工时模式：在指定日期区间内，每个工作日分配固定的每天工时
- 分配明细记录每天分配的工时，便于查看和统计
- 计划工时可以修改和删除（由有权限的用户操作）

**计算逻辑**：
- **合计工时模式**：
  - 计算日期区间内的工作日数量（排除周末和节假日）
  - 将总工时平均分配到每个工作日：`dailyHours = totalHours / workDays`
  - 如果无法整除，最后一天分配剩余工时
- **每天工时模式**：
  - 计算日期区间内的工作日数量（排除周末和节假日）
  - 每个工作日分配固定的每天工时：`allocatedHours = dailyHours * workDays`

#### ActualWorkHour（实际工时）

**录入模式（`inputMode`）**：
- `total_hours`：合计工时模式（录入总工时，系统自动分配到工作日）
- `daily_hours`：每天工时模式（录入每天工时，系统按工作日计算总工时）

**核心字段**：
- `id`：实际工时ID（唯一标识）
- `taskId`：关联的任务ID（必填）
- `inputMode`：录入模式（必填：'total_hours' | 'daily_hours'）
- `totalHours`：总工时（合计工时模式必填）
- `dailyHours`：每天工时（每天工时模式必填）
- `startDate`：开始日期（必填）
- `endDate`：结束日期（必填）
- `actualHours`：实际总工时（系统计算）
- `hourDetails`：工时明细（JSON格式，记录每天的实际工时）
- `recordedBy`：录入人ID（必填，必须是任务执行人）
- `recordedByName`：录入人姓名
- `recordedAt`：录入时间
- `createdAt`：创建时间
- `updatedAt`：更新时间

**业务规则**：
- 只有任务执行人本人可以录入实际工时
- 实际工时录入时，系统自动排除周末和节假日
- 合计工时模式：录入总工时，系统自动平均分配到每个工作日
- 每天工时模式：录入每天工时，系统按工作日计算总工时
- 工时明细记录每天的实际工时，便于查看和统计
- 实际工时可以修改和删除（由任务执行人本人操作）

**计算逻辑**：
- **合计工时模式**：
  - 计算日期区间内的工作日数量（排除周末和节假日）
  - 将总工时平均分配到每个工作日：`dailyHours = totalHours / workDays`
  - 如果无法整除，最后一天分配剩余工时
- **每天工时模式**：
  - 计算日期区间内的工作日数量（排除周末和节假日）
  - 计算总工时：`actualHours = dailyHours * workDays`

#### Holiday（节假日）

**核心字段**：
- `id`：节假日ID（唯一标识）
- `date`：日期（必填，格式：YYYY-MM-DD）
- `name`：节假日名称（必填）
- `type`：类型（'holiday' | 'workday'，可选，默认：'holiday'）
- `year`：年份（必填，用于快速查询）
- `createdAt`：创建时间
- `updatedAt`：更新时间

**业务规则**：
- 节假日用于排除计划工时和实际工时的分配日期
- 支持设置调休工作日（`type = 'workday'`），在周末或节假日标记为工作日
- 节假日数据由系统管理员维护
- 系统在计算工作日时，自动排除节假日，包含调休工作日

## 二、权限控制规则

### 2.1 任务管理权限

**任务创建权限**：

| 业务实体类型 | 权限要求 | 说明 |
|------------|---------|------|
| `commercial_project`（商业项目） | 项目归属部门主管 **或** 项目经理 | 项目拥有者或项目经理可以创建任务 |
| `presales_opportunity`（售前支持） | 归属部门主管 | 售前支持由主管创建，主管可以创建任务 |
| `contribution`（专业贡献） | 系统自动创建 | 专业贡献审批通过后，系统自动为每个执行人创建任务 |
| `other_task`（其他任务） | 归属部门主管 | 其他任务由主管创建，主管可以创建任务 |

**计划工时分配权限**：
- 与任务创建权限相同
- 只有具有任务管理权限的人员才能分配、修改、删除计划工时
- 商业项目：项目归属部门主管或项目经理
- 售前支持：归属部门主管
- 专业贡献：归属部门主管（系统自动创建任务后，主管可以分配计划工时）
- 其他任务：归属部门主管

**实际工时录入权限**：
- 只能由任务执行者本人录入
- 执行者只能录入自己任务的工时，不能录入他人任务的工时

### 2.2 权限验证说明

**权限验证时机**：
- 创建任务时：验证创建人是否有权限为该业务实体创建任务
- 分配计划工时时：验证操作人是否有权限管理该任务
- 录入实际工时时：验证录入人是否为任务执行者本人

**权限判断逻辑**：
- 根据业务实体类型和归属部门，判断操作人是否为部门主管
- 商业项目还需要判断是否为项目经理
- 专业贡献的任务由系统自动创建，主管可以分配计划工时

## 三、任务管理规则

### 3.1 任务创建

**业务流程**：
1. 根据业务实体类型，确定任务创建权限
2. 填写任务基本信息：
   - 任务名称（必填）
   - 任务描述（可选）
   - 任务执行人（必填）
   - 开始日期（可选）
   - 结束日期（可选）
   - 优先级（可选）
3. 系统自动设置：
   - `entityType`：根据业务实体类型设置
   - `entityId`：关联的业务实体ID
   - `status`：默认为"进行中"（`in_progress`）
   - `createdBy`：当前用户ID
4. 提交后创建任务

**业务规则**：
- 任务创建后，状态默认为"进行中"
- 任务必须关联到一个业务实体
- 任务必须有一个执行人
- 专业贡献的任务由系统自动创建，不需要手动创建
- 其他任务由主管创建，可以手动创建任务

### 3.2 任务状态流转

**状态流转图**：
```
进行中 → 已完成
  ↓
已取消
```

**状态说明**：
- `in_progress`：进行中（默认状态）
- `completed`：已完成
- `cancelled`：已取消

**状态变更规则**：
- 任务创建后，状态默认为"进行中"
- 任务执行人可以标记任务为"已完成"
- 任务创建者或具有管理权限的人员可以取消任务
- 任务取消后，状态变为"已取消"

### 3.3 任务编辑和删除

**编辑权限**：
- 任务创建者可以编辑任务
- 具有任务管理权限的人员可以编辑任务

**删除权限**：
- 任务创建者可以删除任务
- 具有任务管理权限的人员可以删除任务
- 如果任务已有计划工时或实际工时记录，建议软删除或提示确认

**业务规则**：
- 任务编辑不影响已分配的计划工时和已录入的实际工时
- 任务删除时，建议同时删除关联的计划工时和实际工时记录（或标记为已删除）

## 四、计划工时分配规则

### 4.1 计划工时分配流程

**业务流程**：
1. 在任务详情页或任务列表中，点击"分配计划工时"
2. 选择日期区间（开始日期、结束日期）
3. 选择分配模式：
   - **合计工时模式**：输入总计划工时（小时）
   - **每天工时模式**：输入每天计划工时（小时）
4. 系统自动计算工作日（排除节假日和周末）
5. 根据选择的模式分配工时：
   - 合计工时模式：系统自动均分工时到每个工作日
   - 每天工时模式：系统为每个工作日分配相同工时
6. 保存计划工时记录

### 4.2 计算逻辑

**工作日计算**：
- 系统根据选择的日期区间，遍历区间内的每一天
- 排除周末（周六和周日）
- 排除节假日（从节假日配置中获取）
- 包含调休工作日（`type = 'workday'`的节假日记录）
- 将剩余的日期作为工作日

**合计工时模式计算**：
- 计算日期区间内的工作日数量（排除周末和节假日）
- 将总计划工时除以工作日数量，得到每天的计划工时（支持小数）
- 如果无法整除，最后一天分配剩余工时
- 公式：`dailyHours = totalHours / workDays`
- 示例：300小时 / 16工作日 = 18.75小时/天

**每天工时模式计算**：
- 计算日期区间内的工作日数量（排除周末和节假日）
- 每个工作日分配固定的每天工时
- 计算总计划工时：`allocatedHours = dailyHours * workDays`
- 示例：8小时/天 × 16工作日 = 128小时

### 4.3 业务规则

**必填字段**：
- 日期区间：开始日期和结束日期必填，结束日期必须晚于或等于开始日期
- 分配模式：必选，合计工时模式或每天工时模式
- 合计工时模式：总计划工时必填，必须 > 0
- 每天工时模式：每天计划工时必填，必须 > 0

**业务规则**：
- 系统自动排除节假日和周末，只分配到工作日
- 如果日期区间内没有工作日，提示错误
- 计划工时可以修改和删除（由有权限的用户操作）
- 支持单天修改和批量修改
- 支持单天删除和批量删除
- 批量修改时，系统重新计算工作日并均分工时

**示例**：
- 选择日期区间：2025-12-01 到 2025-12-20（共20天）
- 假设期间有4个休息日或节假日（12-07、12-08、12-14、12-15）
- 工作日数量：20 - 4 = 16天

**合计工时模式示例**：
- 输入总计划工时：300小时
- 每天计划工时：300 / 16 = 18.75小时

**每天工时模式示例**：
- 输入每天计划工时：8小时
- 总计划工时：8 × 16 = 128小时

### 4.4 计划工时修改和删除

**修改流程**：
1. 在任务详情页的计划工时列表中，可以修改单天的计划工时
2. 也可以批量修改：选择日期区间，输入新的总工时，系统重新均分
3. 保存修改后的计划工时记录

**删除流程**：
1. 在任务详情页的计划工时列表中，点击删除按钮
2. 支持单天删除和批量删除
3. 确认删除后，删除计划工时记录

**业务规则**：
- 只有具有任务管理权限的人员才能修改、删除计划工时
- 修改计划工时支持单天修改和批量修改
- 删除计划工时支持单天删除和批量删除
- 批量修改时，系统重新计算工作日并均分工时

## 五、实际工时录入规则

### 5.1 实际工时录入流程

**业务流程**：
1. 任务执行者在任务详情页或任务列表中，点击"录入实际工时"
2. 选择日期区间（开始日期、结束日期）
3. 选择录入模式：
   - **合计工时模式**：输入总工时，系统自动均分到每个工作日
   - **每天工时模式**：输入每天工时，系统为每个工作日录入相同工时
4. 输入工时（小时）
5. 系统自动计算工作日（排除节假日和周末）
6. 根据模式分配工时到工作日
7. 保存实际工时记录

### 5.2 计算逻辑

**工作日计算**：
- 系统根据选择的日期区间，遍历区间内的每一天
- 排除周末（周六和周日）
- 排除节假日（从节假日配置中获取）
- 包含调休工作日（`type = 'workday'`的节假日记录）
- 将剩余的日期作为工作日

**合计工时模式计算**：
- 计算日期区间内的工作日数量（排除周末和节假日）
- 将输入的总工时除以工作日数量，得到每天的实际工时
- 如果无法整除，最后一天分配剩余工时
- 公式：`dailyHours = totalHours / workDays`
- 为每个工作日创建实际工时记录，记录相同的每天工时

**每天工时模式计算**：
- 计算日期区间内的工作日数量（排除周末和节假日）
- 为每个工作日创建实际工时记录，记录相同的每天工时（用户输入的工时）
- 计算总工时：`actualHours = dailyHours * workDays`

### 5.3 业务规则

**必填字段**：
- 日期区间：开始日期和结束日期必填，结束日期必须晚于或等于开始日期
- 录入模式：必选，合计工时模式或每天工时模式
- 合计工时模式：总工时必填，必须 >= 0（允许为0，表示该天未工作）
- 每天工时模式：每天工时必填，必须 >= 0（允许为0，表示该天未工作）

**业务规则**：
- 只能由任务执行者本人录入
- 系统自动排除节假日和周末，只分配到工作日
- 如果日期区间内没有工作日，提示错误
- 支持覆盖已有记录：如果某天已有实际工时记录，则更新；否则创建新记录
- 实际工时可以修改和删除（由任务执行人本人操作）

**示例**：

**合计工时模式**：
- 选择日期区间：2025-12-01 到 2025-12-05（共5天，假设都是工作日）
- 选择模式：合计工时
- 输入总工时：40小时
- 系统自动计算：40 / 5 = 8小时/天
- 结果：每个工作日记录8小时

**每天工时模式**：
- 选择日期区间：2025-12-01 到 2025-12-05（共5天，假设都是工作日）
- 选择模式：每天工时
- 输入每天工时：8小时
- 系统自动计算：8 × 5 = 40小时
- 结果：每个工作日记录8小时，总工时40小时

## 六、工时统计规则

### 6.1 工时统计维度

**统计维度**：
- 按任务统计：统计单个任务的计划工时和实际工时
- 按执行人统计：统计单个执行人的计划工时和实际工时
- 按业务实体统计：统计业务实体（项目、售前支持、专业贡献、其他任务）的计划工时和实际工时
- 按日期区间统计：统计指定日期区间内的计划工时和实际工时
- 按部门统计：统计部门的计划工时和实际工时

### 6.2 工时统计指标

**基础指标**：
- 计划工时总数：所有计划工时的总和
- 实际工时总数：所有实际工时的总和
- 工时完成率：实际工时 / 计划工时 × 100%
- 工时差异：实际工时 - 计划工时

**详细指标**：
- 按天统计：每天的计划工时和实际工时
- 按周统计：每周的计划工时和实际工时
- 按月统计：每月的计划工时和实际工时
- 按任务统计：每个任务的计划工时和实际工时
- 按执行人统计：每个执行人的计划工时和实际工时

### 6.3 工时统计计算

**计算逻辑**：
- 统计时，系统自动汇总计划工时和实际工时
- 支持按日期区间筛选
- 支持按任务、执行人、业务实体等维度筛选
- 支持按部门筛选
- 工时完成率计算：如果计划工时为0，则完成率为0；否则为实际工时/计划工时×100%

**业务规则**：
- 工时统计支持实时计算和定时计算
- 工时统计结果可以导出为Excel或PDF
- 工时统计支持多维度组合筛选

## 七、工时日历视图

### 7.1 日历视图功能

**视图类型**：
- 月视图：显示一个月的计划工时和实际工时
- 周视图：显示一周的计划工时和实际工时
- 日视图：显示一天的计划工时和实际工时

**显示内容**：
- 日期：显示日期和星期
- 计划工时：显示当天的计划工时（如果有）
- 实际工时：显示当天的实际工时（如果有）
- 工时差异：显示实际工时与计划工时的差异
- 任务信息：显示关联的任务名称和执行人

### 7.2 日历视图交互

**查看操作**：
- 点击日期：查看当天的详细工时信息
- 点击任务：查看任务的详细信息
- 切换视图：在月视图、周视图、日视图之间切换
- 切换月份/周：查看不同时间段的数据

**筛选操作**：
- 按任务筛选：只显示指定任务的工时
- 按执行人筛选：只显示指定执行人的工时
- 按业务实体筛选：只显示指定业务实体的工时
- 按部门筛选：只显示指定部门的工时

**录入操作**：
- 在日历视图中，可以直接点击日期录入实际工时
- 支持合计工时模式和每天工时模式
- 录入后，日历视图自动更新

### 7.3 日历视图显示规则

**颜色标识**：
- 计划工时：使用蓝色标识
- 实际工时：使用绿色标识
- 工时差异：实际工时 > 计划工时（红色），实际工时 < 计划工时（黄色），实际工时 = 计划工时（绿色）
- 节假日：使用灰色标识，不显示工时

**显示规则**：
- 如果当天有计划工时，显示计划工时数值
- 如果当天有实际工时，显示实际工时数值
- 如果当天有计划工时和实际工时，同时显示两者
- 如果当天是节假日，不显示工时，使用灰色标识
- 如果当天没有工时，显示为空

### 7.4 日历视图权限

**查看权限**：
- 所有用户都可以查看自己的工时日历
- 主管可以查看下属的工时日历
- 系统管理员可以查看所有用户的工时日历

**录入权限**：
- 只能由任务执行者本人在日历视图中录入实际工时
- 主管不能替下属录入实际工时

## 八、交互设计

### 8.1 任务列表展示

**展示位置**：
- 商业项目详情页：显示项目关联的所有任务
- 售前支持详情页：显示售前支持关联的所有任务
- 专业贡献详情页：显示专业贡献关联的所有任务
- 其他任务详情页：显示其他任务关联的所有任务

**列表字段**：
- 任务名称
- 执行者
- 任务状态
- 计划工时（总工时）
- 实际工时（总工时）
- 工时完成率
- 操作按钮（查看详情、编辑、删除）

### 8.2 任务详情页

**展示内容**：
- 任务基本信息：任务名称、任务描述、执行者、创建者、创建时间、状态
- 计划工时列表：按日期显示计划工时，支持修改、删除
- 实际工时列表：按日期显示实际工时，支持录入、修改
- 工时统计：总计划工时、总实际工时、工时差异、完成率
- 工时对比图表：计划工时 vs 实际工时对比

### 8.3 计划工时分配弹窗

**表单字段**：
- 日期区间选择器（开始日期、结束日期）
- 分配模式选择（合计工时 / 每天工时）
- 工时输入框（根据模式显示不同提示）：
  - 合计工时模式：总计划工时输入框（小时，支持小数）
  - 每天工时模式：每天计划工时输入框（小时，支持小数）
- 工作日数量显示（只读，系统自动计算）
- 每天计划工时显示（只读，系统自动计算，合计工时模式时显示）
- 总计划工时显示（只读，系统自动计算，每天工时模式时显示）

**交互流程**：
1. 选择日期区间
2. 系统自动计算工作日数量并显示
3. 选择分配模式（合计工时 / 每天工时）
4. 输入工时（合计工时模式输入总工时，每天工时模式输入每天工时）
5. 系统自动计算并显示：
   - 合计工时模式：显示每天计划工时
   - 每天工时模式：显示总计划工时和每天计划工时
6. 点击"确定"保存计划工时
7. 保存成功后，关闭弹窗并刷新任务详情页

### 8.4 实际工时录入弹窗

**表单字段**：
- 日期区间选择器（开始日期、结束日期）
- 录入模式选择（合计工时 / 每天工时）
- 工时输入框（根据模式显示不同提示）：
  - 合计工时模式：总工时输入框（小时，支持小数）
  - 每天工时模式：每天工时输入框（小时，支持小数）
- 工作日数量显示（只读，系统自动计算）
- 每天实际工时显示（只读，系统自动计算，合计工时模式时显示）
- 总实际工时显示（只读，系统自动计算，每天工时模式时显示）

**交互流程**：
1. 选择日期区间
2. 系统自动计算工作日数量并显示
3. 选择录入模式（合计工时 / 每天工时）
4. 输入工时（合计工时模式输入总工时，每天工时模式输入每天工时）
5. 系统自动计算并显示：
   - 合计工时模式：显示每天实际工时和总实际工时
   - 每天工时模式：显示总实际工时和每天实际工时
6. 点击"确定"保存实际工时
7. 保存成功后，关闭弹窗并刷新任务详情页

### 8.5 工时日历视图

**视图布局**：
- 顶部：筛选条件（任务、执行人、业务实体、部门）和视图切换（月/周/日）
- 中间：日历视图（月视图、周视图、日视图）
- 底部：图例说明（计划工时、实际工时、工时差异）

**交互操作**：
- 点击日期：查看当天的详细工时信息
- 点击任务：查看任务的详细信息
- 在日历中录入：点击日期，弹出实际工时录入弹窗
- 切换视图：在月视图、周视图、日视图之间切换
- 切换月份/周：查看不同时间段的数据
- 筛选：按任务、执行人、业务实体、部门筛选

## 九、业务约束规则

### 9.1 数据完整性约束

**任务关联约束**：
- 任务必须关联到一个业务实体（`entityType` 和 `entityId` 必填）
- 删除业务实体时，建议清理关联的任务（或标记为已取消）

**计划工时约束**：
- 计划工时必须关联到任务（`taskId` 必填）
- 计划工时的日期必须在任务的有效期内（如果有开始日期和结束日期）
- 计划工时按日期区间存储，支持多条记录

**实际工时约束**：
- 实际工时必须关联到任务（`taskId` 必填）
- 实际工时的录入人必须是任务执行者本人（`recordedBy = assigneeId`）
- 实际工时按日期区间存储，支持多条记录

### 9.2 业务规则约束

**任务创建约束**：
- 任务名称不能为空
- 执行者必选
- 专业贡献的任务由系统自动创建，不需要手动创建

**计划工时分配约束**：
- 日期区间必填，结束日期必须晚于或等于开始日期
- 分配模式必选：合计工时模式或每天工时模式
- 合计工时模式：总计划工时必填，必须 > 0
- 每天工时模式：每天计划工时必填，必须 > 0
- 日期区间内必须有工作日（排除节假日和周末后）

**实际工时录入约束**：
- 只能由任务执行者本人录入
- 日期区间必填，结束日期必须晚于或等于开始日期
- 录入模式必选：合计工时模式或每天工时模式
- 合计工时模式：总工时必填，必须 >= 0
- 每天工时模式：每天工时必填，必须 >= 0
- 日期区间内必须有工作日（排除节假日和周末后）

**权限约束**：
- 任务创建和计划工时分配需要相应的管理权限
- 实际工时录入只能由执行者本人操作

## 十、节假日管理

### 10.1 节假日数据来源

**方案1：使用第三方API（推荐）**：
- 使用节假日API（如：https://timor.tech/api/holiday）
- 自动获取每年的节假日数据
- 支持查询指定年份的节假日

**方案2：本地维护节假日配置表**：
- 在数据库中维护节假日表（`Holiday`）
- 支持手动配置每年的节假日
- 提供管理界面让管理员配置节假日

### 10.2 节假日判断逻辑

**判断规则**：
- 判断是否为节假日：检查该日期是否在节假日配置列表中（`type = 'holiday'`）
- 判断是否为周末：检查该日期的星期数，周六和周日为周末
- 判断是否为调休工作日：检查该日期是否在节假日配置列表中（`type = 'workday'`）
- 判断是否为工作日：既不是周末，也不是节假日，或者是调休工作日的日期为工作日

### 10.3 工作日计算

**计算规则**：
- 根据选择的日期区间，遍历区间内的每一天
- 排除周末（周六和周日）
- 排除节假日（从节假日配置中获取该年份的节假日列表，`type = 'holiday'`）
- 包含调休工作日（从节假日配置中获取该年份的调休工作日列表，`type = 'workday'`）
- 将剩余的日期作为工作日返回

## 十一、总结

任务和工时管理模块的核心逻辑是：
1. **任务管理**：支持为商业项目、售前支持、专业贡献、其他任务创建任务，任务创建后状态默认为"进行中"
2. **计划工时分配**：支持两种分配模式（合计工时模式和每天工时模式），系统自动排除节假日和周末
3. **实际工时录入**：任务执行者本人可以录入实际工时，支持两种录入模式（合计工时模式和每天工时模式）
4. **工时统计**：支持多维度统计（按任务、执行人、业务实体、日期区间、部门）
5. **工时日历视图**：提供月视图、周视图、日视图，支持查看和录入工时

主要特点：
1. 任务创建后状态默认为"进行中"，不需要"待启动"状态
2. 计划工时和实际工时都支持两种模式：合计工时模式和每天工时模式
3. 系统自动排除节假日和周末，只分配到工作日
4. 支持调休工作日，在周末或节假日标记为工作日
5. 只有任务执行者本人可以录入实际工时
6. 提供工时日历视图，方便查看和录入工时
7. 支持多维度工时统计和分析

